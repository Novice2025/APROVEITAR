<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aproveitar in English</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for ADHD accessibility */
        body { font-family: 'Inter', sans-serif; }
        .module-nav-item.active {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(234, 88, 12, 0.4);
            border-color: #ea580c; /* orange-600 */
        }
        /* Custom dynamic colors for consistency across different Tailwind shades */
        .bg-blue-100 { background-color: #EBF8FF; } .border-blue-400 { border-color: #63B3ED; }
        .bg-orange-100 { background-color: #FEFCBF; } .border-orange-400 { border-color: #F6AD55; }
        .bg-red-100 { background-color: #FED7D7; } .border-red-400 { border-color: #F56565; }
        .bg-indigo-100 { background-color: #EBF4FF; } .border-indigo-400 { border-color: #667EEA; }
        .bg-yellow-100 { background-color: #FFFDE7; } .border-yellow-400 { border-color: #F6E05E; }
        .bg-pink-100 { background-color: #FEE2F8; } .border-pink-400 { border-color: #ED64A6; }
        .bg-green-100 { background-color: #E6FFFA; } .border-green-400 { border-color: #48BB78; }
        .bg-purple-100 { background-color: #F3E8FF; } .border-purple-400 { border-color: #9F7AEA; }
        .bg-cyan-100 { background-color: #E0F7FA; } .border-cyan-400 { border-color: #00BCD4; }
        .bg-teal-100 { background-color: #E6FFFA; } .border-teal-400 { border-color: #38B2AC; }
        .bg-lime-100 { background-color: #F7FFEE; } .border-lime-400 { border-color: #A0D36D; }
        .bg-stone-100 { background-color: #F5F5F4; } .border-stone-400 { border-color: #A8A29E; }
        .bg-gray-100 { background-color: #F7FAFC; } .border-gray-400 { border-color: #CBD5E0; }
        .bg-fuchsia-100 { background-color: #FDF2F8; } .border-fuchsia-400 { border-color: #D946EF; }
        .bg-sky-100 { background-color: #F0F9FF; } .border-sky-400 { border-color: #38BDF8; }
        
        /* Drag and Drop Specific Styles */
        .draggable {
            cursor: grab;
            transition: transform 0.1s;
        }
        .draggable:active {
            cursor: grabbing;
        }
        .drop-target {
            min-width: 150px;
            min-height: 44px;
            transition: all 0.2s;
        }
        .drag-over {
            transform: scale(1.05);
            box-shadow: 0 0 0 4px #06b6d4; /* cyan-500 ring */
        }
        .correct {
            border-color: #10b981 !important; /* emerald-500 */
            background-color: #d1fae5 !important; /* emerald-100 */
        }
        .incorrect {
            border-color: #ef4444 !important; /* red-500 */
            background-color: #fee2e2 !important; /* red-100 */
        }

    </style>
</head>
<body class="min-h-screen bg-gray-50 antialiased text-gray-800">

    <div id="app-container">
        <!-- Header will be dynamically rendered here -->
        <!-- Main content will be dynamically rendered here -->
    </div>

    <script>
        // --- Application Data: The Aproveitar Modules ---
        const modules = [
          {
            id: 'advantage',
            title: "1. Aproveitar = To Take Advantage Of",
            subtitle: "Meaning: Seizing a good opportunity or a fleeting resource.",
            blocks: [
              {
                icon: 'üí°',
                title: 'Core Concept (Opportunities)',
                content: 'Use a chance that is valuable and won\'t last long (like a discount, a sale, or a lucky break). Also applies to taking advantage of a positive situation.',
                color: 'blue-100 border-blue-400',
                examplePt: 'Eu vou aproveitar a promo√ß√£o de passagens a√©reas.',
                exampleEn: 'I\'m going to take advantage of the flight sale.'
              },
              {
                icon: 'üéØ',
                title: 'Primary Equivalent (Most Common)',
                content: 'The most direct and common phrase is: **To Take Advantage Of**. This is usually used when someone benefits from another person\'s absence, generosity, or error in a minor, non-malicious way.',
                color: 'orange-100 border-orange-400',
                examplePt: 'Aproveita que a chefe n√£o est√°!',
                exampleEn: 'Take advantage of the fact that the boss isn\'t here!'
              },
              {
                icon: '‚ö°Ô∏è',
                title: 'Action Phrases (Seizing)',
                content: 'When the action is sudden or urgent, use phrases like: **To Seize the Chance**, **To Seize the Opportunity**, or **To Seize the Golden Opportunity**.',
                color: 'red-100 border-red-400',
                examplePt: 'Temos que aproveitar a oportunidade agora!',
                exampleEn: 'We have to seize the opportunity now!'
              },
              {
                icon: 'üí∞',
                title: 'Strategic Use (Capitalize)',
                content: 'When the action has a business, financial, or strategic outcome, use: **To Capitalize On**. This sounds calculated and formal.',
                color: 'indigo-100 border-indigo-400',
                examplePt: 'A empresa aproveitou o pico de vendas.',
                exampleEn: 'The company capitalized on the sales peak.'
              },
              {
                icon: '‚úÖ',
                title: 'Flexible Use (Time/Resource)',
                content: 'You can also say: **To Make the Most Of** when talking about time, experiences, or a limited resource (like a scholarship or a free trial).',
                color: 'yellow-100 border-yellow-400',
                examplePt: 'Aproveita o seu tempo livre!',
                exampleEn: 'Make the most of your free time!'
              }
            ],
            warning: {
              title: 'DANGER WARNING: Negative Use',
              content: 'Be careful! "To take advantage of" can be negative, meaning **to exploit or treat unfairly**. Always use it positively for opportunities/deals. Example of BAD use: He took advantage of his grandmother (he was cruel).',
            },
          },
          {
            id: 'enjoy',
            title: "2. Aproveitar = To Enjoy / To Have a Good Time",
            subtitle: "Meaning: Experiencing pleasure or fun during an activity.",
            blocks: [
              {
                icon: 'ü•≥',
                title: 'Core Concept (Sensory & Pleasure)',
                content: 'This is simple: when you are having fun, feeling happy, or experiencing something pleasurable (like a beautiful view or a delicious meal).',
                color: 'pink-100 border-pink-400',
                examplePt: 'Eu me aproveitei muito na festa de ontem.',
                exampleEn: 'I had a really good time at the party yesterday.'
              },
              {
                icon: 'üéØ',
                title: 'English Equivalent (Direct Use)',
                content: 'The main equivalents are: **To Enjoy** (followed by the thing) or **To Have a Good Time** (used generally).',
                color: 'green-100 border-green-400',
                examplePt: 'Aproveite o seu almo√ßo!',
                exampleEn: 'Enjoy your lunch!'
              },
              {
                icon: 'üó£Ô∏è',
                title: 'Usage Tip (Reflexive)',
                content: 'When Portuguese uses the reflexive form (**"se aproveitar"**), English uses "to enjoy oneself" or "to have a good time." Do NOT use "take advantage of myself!"',
                color: 'yellow-100 border-yellow-400',
                examplePt: 'Eles se aproveitaram muito na praia.',
                exampleEn: 'They enjoyed themselves a lot at the beach. / They had a lot of fun at the beach.'
              },
              {
                icon: 'üëã',
                title: 'Common Farewell (Informal)',
                content: 'Used often in greetings or farewells: **Have fun! / Enjoy!** This is a very common translation in casual settings.',
                color: 'purple-100 border-purple-400',
                examplePt: 'Tchau! Aproveitem o show!',
                exampleEn: 'Bye! Enjoy the show! / Have a great time at the show!'
              },
              {
                icon: 'üåü',
                title: 'Wishing Well (Future/Formal)',
                content: 'Used to wish someone enjoyment in a future event (like a trip, movie, or retirement).',
                color: 'cyan-100 border-cyan-400',
                examplePt: 'Espero que voc√™s aproveitem a viagem!',
                exampleEn: 'I hope you enjoy the trip! / I hope you have a great time on the trip!'
              }
            ],
          },
          {
            id: 'use',
            title: "3. Aproveitar = To Use / To Utilize (Waste Reduction)",
            subtitle: "Meaning: Making practical use of an item that might otherwise be discarded or wasted.",
            blocks: [
              {
                icon: '‚ôªÔ∏è',
                title: 'Core Concept (Practical Use)',
                content: 'This is about being practical and not wasteful. It focuses on using up resources (like leftovers, scraps, or natural resources).',
                color: 'teal-100 border-teal-400',
                examplePt: 'Vamos aproveitar o resto do tecido para fazer uma capa.',
                exampleEn: 'We are going to use the rest of the fabric to make a cover.'
              },
              {
                icon: 'üéØ',
                title: 'English Equivalent (Simplicity)',
                content: 'The clearest translation is simply: **To Use** or **To Utilize**. (Keep it simple!)',
                color: 'red-100 border-red-400',
                examplePt: 'A gente aproveita tudo do animal, nada √© jogado fora.',
                exampleEn: 'We utilize everything from the animal, nothing is thrown away.'
              },
              {
                icon: 'üë©‚Äçüç≥',
                title: 'In the Kitchen (Leftovers)',
                content: 'Often used with food or cooking leftovers (as in "waste not, want not").',
                color: 'lime-100 border-lime-400',
                examplePt: 'Aproveite as sobras para fazer sopa amanh√£.',
                exampleEn: 'Use the leftovers to make soup tomorrow.'
              },
              {
                icon: 'üìö',
                title: 'Knowledge/Skill Utilization',
                content: 'It can also mean putting knowledge, skills, or experience to practical use.',
                color: 'stone-100 border-stone-400',
                examplePt: 'Ele aproveitou as aulas de hist√≥ria no projeto.',
                exampleEn: 'He utilized the history lessons in the project.'
              },
              {
                icon: 'üö´',
                title: 'What NOT to Say',
                content: 'Do NOT say: "Take advantage of the leftovers." It sounds awkward and wrong. Stick to "Use." In English, "Take advantage of" almost always applies to situations, not physical leftovers.',
                color: 'indigo-100 border-indigo-400',
                examplePt: 'Aproveitaram a chuva para encher os baldes.',
                exampleEn: 'They used the rain to fill the buckets.'
              }
            ],
          },
          {
            id: 'professional',
            title: "4. Aproveitar in Professional Settings = business meetings - interview and presentation", 
            subtitle: "Meaning: Using formal and strategic equivalents for business, interviews, and presentations.",
            blocks: [
              {
                icon: 'üìà',
                title: 'Strategy & Investment (Capitalize)',
                content: 'Use **To Capitalize On** when discussing market trends, investments, or strategic moves in formal meetings or reports. It suggests a smart business decision.',
                color: 'gray-100 border-gray-400',
                examplePt: 'Temos que aproveitar a nova regulamenta√ß√£o para entrar no mercado.',
                exampleEn: 'We need to capitalize on the new regulation to enter the market.'
              },
              {
                icon: '‚åö',
                title: 'Time & Agenda (Make the Most)',
                content: 'Use **To Make the Most Of** when referring to maximizing the use of limited time (like a meeting agenda, conference slot, or deadline).',
                color: 'stone-100 border-stone-400',
                examplePt: 'Precisamos aproveitar bem os 30 minutos da reuni√£o.',
                exampleEn: 'We need to make the most of the 30 minutes in the meeting.'
              },
              {
                icon: 'üé§',
                title: 'Interviews & Pitching (Seize)',
                content: 'Use **To Seize the Opportunity** in high-stakes, verbal situations like job interviews, pitches, or Q&A sessions where you must act decisively.',
                color: 'fuchsia-100 border-fuchsia-400',
                examplePt: 'Eu aproveitei a chance para fazer uma pergunta ao CEO.',
                exampleEn: 'I seized the opportunity to ask the CEO a question.'
              },
              {
                icon: 'üìä',
                title: 'Data & Experience (Leverage/Utilize)',
                content: 'Use **To Utilize** or **To Leverage** (Leverage is stronger, meaning to use to maximum advantage) when discussing past results, data, or skills in a formal presentation or proposal.',
                color: 'sky-100 border-sky-400',
                examplePt: 'Aproveitamos os dados do ano passado para prever a demanda.',
                exampleEn: 'We utilized/leveraged last year\'s data to forecast demand.'
              },
            ],
          },
          // --- NEW MODULE: DRAG & DROP EXERCISE ---
          {
            id: 'exercise',
            title: "5. Aproveitar = Drag & Drop Exercise (Advanced)",
            subtitle: "Match the Portuguese sentence to its most appropriate English translation by dragging the colored tiles into the drop zones.",
            blocks: [], // Content is rendered dynamically by renderExerciseUI
            exerciseData: [
                {
                    pt: "Eu me aproveitei das f√©rias para ler todos os livros que eu queria.",
                    correctEnglish: 'To Make the Most Of',
                    conceptId: 'flexible-use',
                },
                {
                    pt: "A empresa precisa aproveitar a baixa taxa de juros para expandir.",
                    correctEnglish: 'To Capitalize On',
                    conceptId: 'strategic-use',
                },
                {
                    pt: "Aproveite o seu bolo de anivers√°rio!",
                    correctEnglish: 'To Enjoy / Have Fun',
                    conceptId: 'direct-use',
                },
                {
                    pt: "Se voc√™ se atrasar, vou aproveitar a sua vaga de estacionamento.",
                    correctEnglish: 'To Take Advantage Of',
                    conceptId: 'primary-equivalent',
                },
                {
                    pt: "Devemos aproveitar o calor da m√°quina para aquecer a sala vizinha.",
                    correctEnglish: 'To Use / To Utilize',
                    conceptId: 'practical-use',
                },
                {
                    pt: "Ela aproveitou a chance para se desculpar durante a pausa.",
                    correctEnglish: 'To Seize the Opportunity',
                    conceptId: 'seize-opportunity',
                }
            ],
            // The draggable terms the user must match
            draggableTerms: [
                { id: 'flexible-use', term: 'To Make the Most Of', color: 'bg-yellow-400 hover:bg-yellow-500' },
                { id: 'strategic-use', term: 'To Capitalize On', color: 'bg-indigo-400 hover:bg-indigo-500' },
                { id: 'direct-use', term: 'To Enjoy / Have Fun', color: 'bg-green-400 hover:bg-green-500' },
                { id: 'primary-equivalent', term: 'To Take Advantage Of', color: 'bg-orange-400 hover:bg-orange-500' },
                { id: 'practical-use', term: 'To Use / To Utilize', color: 'bg-teal-400 hover:bg-teal-500' },
                { id: 'seize-opportunity', term: 'To Seize the Opportunity', color: 'bg-red-400 hover:bg-red-500' },
            ]
          }
        ];

        // --- State Management and Core Logic ---
        let activeModuleId = 'advantage';
        const appContainer = document.getElementById('app-container');

        // Function to create the HTML string for a single "Lego Block"
        function createBlockHTML(block) {
            return `
                <div class="p-5 rounded-xl shadow-md transition duration-300 hover:shadow-lg flex flex-col space-y-3 
                            bg-${block.color} border-2 border-opacity-75">
                    
                    <h3 class="text-xl font-extrabold flex items-center text-gray-800">
                        <span class="text-3xl mr-3">${block.icon}</span>
                        ${block.title}
                    </h3>

                    <p class="text-gray-700 font-medium whitespace-pre-wrap">
                        ${block.content}
                    </p>

                    <div class="mt-3 p-3 bg-white/70 rounded-lg shadow-inner border border-dashed border-gray-300">
                        <p class="text-sm italic text-blue-600">
                            **P.T. Example:** ${block.examplePt}
                        </p>
                        <p class="text-sm font-semibold text-teal-700 mt-1">
                            **E.N. Translation:** ${block.exampleEn}
                        </p>
                    </div>
                </div>
            `;
        }
        
        // --- Drag and Drop Logic ---

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = e.target;
            e.dataTransfer.setData('text/plain', e.target.id);
            // Add a visual cue when dragging starts
            setTimeout(() => {
                e.target.classList.add('opacity-50', 'shadow-2xl');
            }, 0);
        }

        function handleDragOver(e) {
            e.preventDefault(); // Necessary to allow dropping
            const target = e.currentTarget;
            if (target.children.length === 0) {
                target.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropTarget = e.currentTarget;
            dropTarget.classList.remove('drag-over');
            
            // Only allow dropping if the spot is empty
            if (dropTarget.children.length === 0 && draggedElement) {
                // Remove visual cue from dragged element
                draggedElement.classList.remove('opacity-50', 'shadow-2xl');
                
                // Append the draggable item to the drop zone
                dropTarget.appendChild(draggedElement);
                
                // Disable dragging once dropped (it can be re-enabled later if moved)
                draggedElement.draggable = false;
            }
        }
        
        function handleDragEnd(e) {
            // Cleanup visual cues on drag end, regardless of drop success
            e.target.classList.remove('opacity-50', 'shadow-2xl');
            draggedElement = null;
        }

        function setupDragAndDropListeners() {
            // Setup Draggable items
            document.querySelectorAll('.draggable').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.draggable = true; // Ensure they are draggable
            });

            // Setup Drop targets
            document.querySelectorAll('.drop-target').forEach(target => {
                target.addEventListener('dragover', handleDragOver);
                target.addEventListener('dragleave', handleDragLeave);
                target.addEventListener('drop', handleDrop);
            });

            // Setup Check Button
            document.getElementById('check-answers-btn')?.addEventListener('click', checkAnswers);
            
            // Setup Reset Button
            document.getElementById('reset-answers-btn')?.addEventListener('click', resetExercise);
        }

        function resetExercise() {
            const exerciseModule = modules.find(m => m.id === 'exercise');
            if (!exerciseModule) return;

            // Move all elements back to the draggable pool
            const dropTargets = document.querySelectorAll('.drop-target');
            const draggablePool = document.getElementById('draggable-pool');
            
            dropTargets.forEach(target => {
                target.classList.remove('correct', 'incorrect');
                while (target.firstChild) {
                    const item = target.firstChild;
                    item.draggable = true;
                    draggablePool.appendChild(item);
                }
            });
            
            // Clear feedback
            document.getElementById('feedback-message').innerHTML = '';
            document.getElementById('feedback-message').classList.remove('bg-green-100', 'bg-red-100');
            document.getElementById('check-answers-btn').classList.remove('hidden');
        }

        function checkAnswers() {
            const dropTargets = document.querySelectorAll('.drop-target');
            let correctCount = 0;

            dropTargets.forEach(target => {
                const droppedItem = target.querySelector('.draggable');
                const correctId = target.getAttribute('data-correct-id');
                
                target.classList.remove('correct', 'incorrect');

                if (droppedItem) {
                    const droppedId = droppedItem.id;
                    if (droppedId === correctId) {
                        target.classList.add('correct');
                        correctCount++;
                    } else {
                        target.classList.add('incorrect');
                    }
                } else {
                    target.classList.add('incorrect'); // Penalize for empty drop zones
                }
            });

            const total = dropTargets.length;
            const score = `${correctCount}/${total}`;
            const percentage = (correctCount / total) * 100;
            const feedbackElement = document.getElementById('feedback-message');
            
            if (percentage === 100) {
                feedbackElement.innerHTML = `üåü Perfect Score! You got ${score} correct! You mastered 'Aproveitar'.`;
                feedbackElement.className = 'p-4 rounded-xl text-lg font-bold text-green-700 bg-green-100 shadow-lg';
                document.getElementById('check-answers-btn').classList.add('hidden');
            } else {
                feedbackElement.innerHTML = `Keep practicing! You scored ${score}. Review the blocks and try again!`;
                feedbackElement.className = 'p-4 rounded-xl text-lg font-bold text-red-700 bg-red-100 shadow-lg';
            }
        }

        // --- UI Generation for Exercise Module ---

        function renderExerciseUI(activeModule) {
            const { exerciseData, draggableTerms } = activeModule;
            
            // Shuffle draggable terms to prevent simple guessing
            const shuffledDraggableTerms = [...draggableTerms].sort(() => Math.random() - 0.5);

            // 1. Draggable Terms (Pool)
            const draggableHtml = shuffledDraggableTerms.map(term => `
                <div id="${term.id}" 
                     class="draggable p-3 rounded-xl shadow-lg font-semibold text-white text-center cursor-grab transition-all 
                            ${term.color} min-w-[180px]"
                     draggable="true">
                    ${term.term}
                </div>
            `).join('');

            // 2. Drop Targets (Sentences)
            const dropTargetHtml = exerciseData.map((data, index) => `
                <div class="flex flex-col md:flex-row items-start md:items-center p-4 bg-white rounded-lg shadow-sm border border-gray-200 space-y-2 md:space-y-0 md:space-x-4">
                    <!-- Portuguese Sentence -->
                    <p class="font-medium text-gray-700 flex-1 min-w-[50%]">
                        <span class="text-sm font-extrabold text-orange-600 mr-2">${index + 1}.</span>
                        ${data.pt}
                    </p>
                    
                    <!-- Drop Zone -->
                    <div class="drop-target flex justify-center items-center w-full md:w-1/3 h-11 border-2 border-dashed border-cyan-400 bg-cyan-50/50 rounded-lg p-1"
                         data-correct-id="${data.conceptId}">
                        <!-- Dragged item goes here -->
                        <span class="text-sm italic text-cyan-600">Drop Translation Here</span>
                    </div>
                    
                    <!-- Hidden Answer for Review (optional, but helpful for learning) 
                    <p class="text-xs text-green-500 hidden" data-answer-id="${data.conceptId}">
                        Correct: ${data.correctEnglish}
                    </p>
                    -->
                </div>
            `).join('');

            return `
                <section class="max-w-4xl mx-auto space-y-8">
                    <h3 class="text-2xl font-bold text-teal-700 border-b pb-2">Available Translations (Drag Them Below)</h3>
                    
                    <!-- Draggable Terms Pool -->
                    <div id="draggable-pool" class="flex flex-wrap gap-4 p-4 bg-gray-100 rounded-xl shadow-inner border border-gray-300">
                        ${draggableHtml}
                    </div>

                    <h3 class="text-2xl font-bold text-teal-700 border-b pb-2 pt-6">Match Portuguese to English</h3>

                    <!-- Drop Target List -->
                    <div class="space-y-4">
                        ${dropTargetHtml}
                    </div>

                    <!-- Action Buttons and Feedback -->
                    <div class="flex flex-col sm:flex-row gap-4 mt-8 justify-center">
                        <button id="check-answers-btn" class="px-6 py-3 bg-teal-600 text-white font-bold rounded-full shadow-lg hover:bg-teal-700 transition duration-200">
                            Check Answers
                        </button>
                        <button id="reset-answers-btn" class="px-6 py-3 bg-gray-300 text-gray-800 font-bold rounded-full shadow-lg hover:bg-gray-400 transition duration-200">
                            Reset Exercise
                        </button>
                    </div>

                    <!-- Feedback Message -->
                    <div id="feedback-message" class="text-center mt-6 p-0 transition-all duration-300">
                        <!-- Score and feedback will appear here -->
                    </div>
                </section>
            `;
        }

        // Function to create the main application structure
        function renderApp() {
            const activeModule = modules.find(m => m.id === activeModuleId) || modules[0];
            
            // 1. Navigation Buttons (Map and Join)
            const navHtml = modules.map(m => {
                // Determine the button label. Split by ' = ' and take the second part (the English meaning/label)
                const label = m.title.split(' = ')[1]; 
                
                // Use the label if it exists, otherwise use the full title
                const buttonText = label ? label : m.title; 

                return `
                    <button
                        data-module-id="${m.id}"
                        class="module-nav-item 
                            px-5 py-2 rounded-full font-bold text-sm shadow-md transition duration-300 ease-in-out
                            ${activeModuleId === m.id 
                                ? 'bg-orange-600 text-white active border-2 border-orange-700' 
                                : 'bg-gray-100 text-gray-700 hover:bg-orange-100 border-2 border-gray-300'
                            }"
                    >
                        ${buttonText.trim()}
                    </button>
                `;
            }).join('');

            let mainContentHtml = '';
            
            // 2. Render content based on module type
            if (activeModule.id === 'exercise') {
                mainContentHtml = renderExerciseUI(activeModule);
            } else {
                // Standard Lego Block Modules
                const blocksHtml = activeModule.blocks.map(createBlockHTML).join('');
                const warningHtml = activeModule.warning ? `
                    <section class="mt-12 p-6 bg-red-100 rounded-xl shadow-xl border-4 border-red-600">
                        <h3 class="text-2xl font-black text-red-800 flex items-center mb-3">
                            <span class="text-4xl mr-3">üö®</span> ${activeModule.warning.title}
                        </h3>
                        <p class="text-lg text-red-700 leading-relaxed">
                            ${activeModule.warning.content}
                        </p>
                    </section>
                ` : '';
                
                mainContentHtml = `
                    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${blocksHtml}
                    </section>
                    ${warningHtml}
                `;
            }

            // 3. Combined HTML for the entire application
            appContainer.innerHTML = `
                <!-- Header and Navigation -->
                <header class="sticky top-0 z-50 bg-white shadow-xl p-4 border-b-4 border-teal-500">
                    <h1 class="text-3xl font-black text-teal-700 text-center">
                        üáßüá∑ Aproveitar in English üá∫üá∏
                    </h1>
                    <p class="text-center text-sm text-gray-500 mt-1">
                        Lego Block Method for Clarity
                    </p>
                    
                    <!-- Navigation Bar (Clear, Distinct Buttons) -->
                    <nav id="nav-container" class="mt-4 flex flex-wrap justify-center gap-3">
                        ${navHtml}
                    </nav>
                </header>

                <!-- Main Content Area -->
                <main class="p-4 md:p-8 lg:p-12">
                    <div class="max-w-6xl mx-auto">

                        <!-- Module Title and Subtitle -->
                        <section class="mb-8 p-6 bg-teal-50 rounded-2xl shadow-inner border-l-8 border-teal-500">
                            <h2 class="text-3xl font-extrabold text-teal-800 mb-2">
                                ${activeModule.title.split(' = ')[0]}
                            </h2>
                            <p class="text-xl text-gray-600 font-semibold">
                                ${activeModule.subtitle}
                            </p>
                        </section>

                        <!-- Dynamic Content Area -->
                        ${mainContentHtml}

                    </div>
                </main>
                
                <!-- Footer -->
                <footer class="p-4 mt-12 text-center text-sm text-gray-500 border-t bg-white">
                    Aproveitar Study App | Designed for Clarity and Focus by @ Daby 2025
                </footer>
            `;

            // 4. Attach event listeners
            document.querySelectorAll('#nav-container button').forEach(button => {
                button.addEventListener('click', () => {
                    handleNavClick(button.getAttribute('data-module-id'));
                });
            });
            
            // 5. Setup D&D listeners if it's the exercise module
            if (activeModule.id === 'exercise') {
                setupDragAndDropListeners();
            }

            // Scroll to top
            window.scrollTo(0, 0); 
        }

        // Function to handle navigation clicks
        function handleNavClick(id) {
            if (activeModuleId !== id) {
                activeModuleId = id;
                renderApp();
            }
        }

        // Initial render on page load
        window.onload = renderApp;

    </script>
</body>
</html>
